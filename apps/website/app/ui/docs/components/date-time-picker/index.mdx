import { CodePreviewer } from '@/components/custom/code-previewer';
import { DateTimePicker, DateTimePickerTrigger, DateTimePickerInput, DateTimePickerIcon } from '@/components/ui/date-time-picker';
import { Box } from '@/components/ui/box';
import { CalendarDaysIcon, ClockIcon, AlertCircleIcon } from '@/components/ui/icon';
import { Text } from '@/components/ui/text';
import { VStack } from '@/components/ui/vstack';
import { FormControl, FormControlLabel, FormControlLabelText, FormControlHelper, FormControlHelperText, FormControlError, FormControlErrorText, FormControlErrorIcon } from '@/components/ui/form-control';

import { CodeBlock } from "@/components/custom/markdown/code-block"; 

import { Canvas, Meta, Story } from '@storybook/addon-docs';

<Meta title="DateTimePicker" />

# DateTimePicker

A comprehensive date and time picker component that provides a native experience on mobile platforms and a custom-built interface for web. Perfect for forms, scheduling, and any date/time input needs.

## Features

- **Cross-platform**: Uses native pickers on iOS/Android, custom on web
- **Expo Go compatible**: Works without ejecting or building
- **Multiple modes**: Date only, Time only, or DateTime combined
- **Fully accessible**: Keyboard navigation, screen reader support, ARIA patterns
- **Customizable styling**: Support for sizes, variants, and custom themes
- **Min/Max date restrictions**: Limit selectable date ranges
- **Locale support**: International date/time formatting
- **Timezone handling**: Proper UTC/local time management
- **Animations**: Smooth transitions using react-native-reanimated
- **Dark mode**: Automatic theme adaptation

## Installation

<Tabs>
<TabItem value="cli" label="CLI">

### Run the following command:

```bash
npx gluestack-ui add date-time-picker
```

</TabItem>
<TabItem value="manual" label="Manual">

### Install dependencies:

```bash
npm install @react-native-community/datetimepicker react-native-reanimated
```

### Copy and paste the component:

Copy the files from `src/components/ui/date-time-picker/` to your project.

</TabItem>
</Tabs>

## Usage

### Basic Example

```jsx
import React, { useState } from 'react';
import {
  DateTimePicker,
  DateTimePickerTrigger,
  DateTimePickerInput,
  DateTimePickerIcon,
} from '@/components/ui/date-time-picker';
import { CalendarDays } from 'lucide-react-native';

function Example() {
  const [date, setDate] = useState(new Date());

  return (
    <DateTimePicker value={date} onChange={setDate} mode="datetime">
      <DateTimePickerTrigger>
        <DateTimePickerInput placeholder="Select date and time" />
        <DateTimePickerIcon as={CalendarDays} />
      </DateTimePickerTrigger>
    </DateTimePicker>
  );
}
```

### Date Only Mode

```jsx
<DateTimePicker
  value={date}
  onChange={setDate}
  mode="date"
  placeholder="Select a date"
>
  <DateTimePickerTrigger>
    <DateTimePickerInput />
    <DateTimePickerIcon as={CalendarDays} />
  </DateTimePickerTrigger>
</DateTimePicker>
```

### Time Only Mode

```jsx
<DateTimePicker
  value={time}
  onChange={setTime}
  mode="time"
  is24Hour={false}
  placeholder="Select time"
>
  <DateTimePickerTrigger>
    <DateTimePickerInput />
    <DateTimePickerIcon as={Clock} />
  </DateTimePickerTrigger>
</DateTimePicker>
```

### With Min/Max Date Restrictions

```jsx
<DateTimePicker
  value={date}
  onChange={setDate}
  mode="date"
  minimumDate={new Date(2024, 0, 1)}
  maximumDate={new Date(2024, 11, 31)}
>
  <DateTimePickerTrigger>
    <DateTimePickerInput />
    <DateTimePickerIcon as={CalendarDays} />
  </DateTimePickerTrigger>
</DateTimePicker>
```

### Custom Format

```jsx
<DateTimePicker
  value={date}
  onChange={setDate}
  mode="datetime"
  format="YYYY-MM-DD HH:mm"
>
  <DateTimePickerTrigger>
    <DateTimePickerInput />
    <DateTimePickerIcon as={CalendarDays} />
  </DateTimePickerTrigger>
</DateTimePicker>
```

### Different Sizes and Variants

```jsx
<DateTimePicker value={date} onChange={setDate}>
  <DateTimePickerTrigger size="sm" variant="outline">
    <DateTimePickerInput />
    <DateTimePickerIcon as={CalendarDays} size="sm" />
  </DateTimePickerTrigger>
</DateTimePicker>

<DateTimePicker value={date} onChange={setDate}>
  <DateTimePickerTrigger size="lg" variant="rounded">
    <DateTimePickerInput />
    <DateTimePickerIcon as={CalendarDays} size="lg" />
  </DateTimePickerTrigger>
</DateTimePicker>
```

## API Reference

### DateTimePicker

The root component that provides context for all date-time-picker sub-components.

| Prop                    | Type                              | Default    | Description                                      |
| ----------------------- | --------------------------------- | ---------- | ------------------------------------------------ |
| value                   | Date                              | undefined  | The currently selected date/time                 |
| onChange                | (date: Date \| undefined) => void | undefined  | Callback when date/time changes                  |
| mode                    | 'date' \| 'time' \| 'datetime'    | 'datetime' | Selection mode                                   |
| minimumDate             | Date                              | undefined  | Minimum selectable date                          |
| maximumDate             | Date                              | undefined  | Maximum selectable date                          |
| locale                  | string                            | undefined  | Locale for formatting (e.g., 'en-US')            |
| timeZoneOffsetInMinutes | number                            | undefined  | Timezone offset in minutes                       |
| is24Hour                | boolean                           | undefined  | Use 24-hour format for time (Android only)       |
| disabled                | boolean                           | false      | Disable the picker                               |
| placeholder             | string                            | undefined  | Placeholder text when no date selected           |
| format                  | string                            | undefined  | Custom display format (e.g., 'YYYY-MM-DD HH:mm') |

### DateTimePickerTrigger

The trigger element that opens the date-time picker.

| Prop    | Type                                   | Default   | Description         |
| ------- | -------------------------------------- | --------- | ------------------- |
| size    | 'sm' \| 'md' \| 'lg' \| 'xl'           | 'md'      | Size of the trigger |
| variant | 'outline' \| 'underlined' \| 'rounded' | 'outline' | Visual variant      |

### DateTimePickerInput

Displays the selected date/time value.

| Prop      | Type   | Default   | Description            |
| --------- | ------ | --------- | ---------------------- |
| className | string | undefined | Additional CSS classes |

### DateTimePickerIcon

Icon displayed in the trigger (typically a calendar or clock icon).

| Prop      | Type                                          | Default   | Description            |
| --------- | --------------------------------------------- | --------- | ---------------------- |
| size      | '2xs' \| 'xs' \| 'sm' \| 'md' \| 'lg' \| 'xl' | 'md'      | Size of the icon       |
| className | string                                        | undefined | Additional CSS classes |

## Format Patterns

When using the `format` prop, you can use these patterns:

| Pattern | Description          | Example |
| ------- | -------------------- | ------- |
| YYYY    | Full year            | 2024    |
| MM      | Month (01-12)        | 01      |
| DD      | Day of month (01-31) | 15      |
| HH      | Hours (00-23)        | 14      |
| mm      | Minutes (00-59)      | 30      |
| ss      | Seconds (00-59)      | 45      |

Example: `format="YYYY-MM-DD HH:mm"` displays as "2024-01-15 14:30"

## Platform Behavior

### iOS

- Uses UIDatePicker with native iOS styling
- Supports all modes: date, time, datetime
- Smooth animations and haptic feedback
- Follows iOS Human Interface Guidelines

### Android

- Uses Android's DatePickerDialog and TimePickerDialog
- Material Design styling
- Supports is24Hour prop for time format
- Full accessibility support

### Web

- Custom modal with HTML5 date/time inputs
- Styled to match gluestack-ui theme
- Keyboard accessible
- Works with all modern browsers

## Accessibility

- **Keyboard Navigation**: Tab to focus, Enter/Space to open, Escape to close
- **Screen Readers**: Announces selected date and picker state
- **ARIA Labels**: Proper labeling for input and dialog
- **Focus Management**: Maintains focus within modal when open
- **High Contrast**: Supports high contrast modes

## Best Practices

1. **Always provide a label**: Use with FormControl for proper labeling
2. **Set reasonable min/max dates**: Prevent users from selecting invalid dates
3. **Use appropriate mode**: Use 'date' for birthdays, 'time' for alarms, 'datetime' for events
4. **Consider locale**: Set locale prop for international users
5. **Handle undefined values**: Always handle case where user cancels picker

## Examples

The Examples section provides visual representations of the different variants of the component, allowing you to quickly and easily determine which one best fits your needs.


  

  A basic DateTimePicker with date and time selection
  
  <CodePreviewer
  code={`function Example() {
  const [date, setDate] = React.useState(new Date());

  return (
    <Box className="p-4 w-full">
      <DateTimePicker
        value={date}
        onChange={setDate}
        mode="datetime"
        placeholder="Select date and time"
      >
        <DateTimePickerTrigger>
          <DateTimePickerInput />
          <DateTimePickerIcon as={CalendarDaysIcon} />
        </DateTimePickerTrigger>
      </DateTimePicker>
    </Box>
  );
}`}
  argTypes={{}}
  reactLive={{ DateTimePicker, DateTimePickerTrigger, DateTimePickerInput, DateTimePickerIcon, Box, CalendarDaysIcon }}
  importMap={{"@/components/ui/date-time-picker":["DateTimePicker","DateTimePickerTrigger","DateTimePickerInput","DateTimePickerIcon"],"@/components/ui/box":["Box"],"@/components/ui/icon":["CalendarDaysIcon"]}}
/>


  #### Different Modes

  DateTimePicker supports three modes: date only, time only, and combined datetime selection
  
  <CodePreviewer
  code={`function Example() {
  const [date, setDate] = React.useState(new Date());
  const [time, setTime] = React.useState(new Date());
  const [dateTime, setDateTime] = React.useState(new Date());

  return (
    <VStack space="lg" className="w-full">
      <Box className="p-4 border border-border rounded-lg bg-card">
        <Text className="text-sm font-semibold mb-3 text-card-foreground">Date Only</Text>
        <DateTimePicker
          value={date}
          onChange={setDate}
          mode="date"
          placeholder="Select a date"
        >
          <DateTimePickerTrigger>
            <DateTimePickerInput />
            <DateTimePickerIcon as={CalendarDaysIcon} />
          </DateTimePickerTrigger>
        </DateTimePicker>
      </Box>

      <Box className="p-4 border border-border rounded-lg bg-card">
        <Text className="text-sm font-semibold mb-3 text-card-foreground">Time Only (12-hour)</Text>
        <DateTimePicker
          value={time}
          onChange={setTime}
          mode="time"
          placeholder="Select time"
        >
          <DateTimePickerTrigger>
            <DateTimePickerInput />
            <DateTimePickerIcon as={ClockIcon} />
          </DateTimePickerTrigger>
        </DateTimePicker>
      </Box>

      <Box className="p-4 border border-border rounded-lg bg-card">
        <Text className="text-sm font-semibold mb-3 text-card-foreground">Date & Time</Text>
        <DateTimePicker
          value={dateTime}
          onChange={setDateTime}
          mode="datetime"
          placeholder="Select date and time"
        >
          <DateTimePickerTrigger>
            <DateTimePickerInput />
            <DateTimePickerIcon as={CalendarDaysIcon} />
          </DateTimePickerTrigger>
        </DateTimePicker>
      </Box>
    </VStack>
  );
}`}
  argTypes={{}}
  reactLive={{ DateTimePicker, DateTimePickerTrigger, DateTimePickerInput, DateTimePickerIcon, Box, Text, VStack, CalendarDaysIcon, ClockIcon }}
  importMap={{"@/components/ui/date-time-picker":["DateTimePicker","DateTimePickerTrigger","DateTimePickerInput","DateTimePickerIcon"],"@/components/ui/box":["Box"],"@/components/ui/text":["Text"],"@/components/ui/vstack":["VStack"],"@/components/ui/icon":["CalendarDaysIcon","ClockIcon"]}}
/>


  #### Variants & Sizes

  DateTimePicker supports multiple visual variants (outline, underlined, rounded) and sizes (sm, md, lg, xl)
  
  <CodePreviewer
  code={`function Example() {
  const [date, setDate] = React.useState(new Date());

  return (
    <VStack space="lg" className="w-full">
      <Box className="p-4 border border-border rounded-lg bg-card">
        <Text className="text-sm font-semibold mb-3 text-card-foreground">Outline Variant (Default)</Text>
        <DateTimePicker
          value={date}
          onChange={setDate}
          mode="date"
          placeholder="Select date"
        >
          <DateTimePickerTrigger variant="outline">
            <DateTimePickerInput />
            <DateTimePickerIcon as={CalendarDaysIcon} />
          </DateTimePickerTrigger>
        </DateTimePicker>
      </Box>

      <Box className="p-4 border border-border rounded-lg bg-card">
        <Text className="text-sm font-semibold mb-3 text-card-foreground">Underlined Variant</Text>
        <DateTimePicker
          value={date}
          onChange={setDate}
          mode="date"
          placeholder="Select date"
        >
          <DateTimePickerTrigger variant="underlined">
            <DateTimePickerInput />
            <DateTimePickerIcon as={CalendarDaysIcon} />
          </DateTimePickerTrigger>
        </DateTimePicker>
      </Box>

      <Box className="p-4 border border-border rounded-lg bg-card">
        <Text className="text-sm font-semibold mb-3 text-card-foreground">Rounded Variant</Text>
        <DateTimePicker
          value={date}
          onChange={setDate}
          mode="date"
          placeholder="Select date"
        >
          <DateTimePickerTrigger variant="rounded">
            <DateTimePickerInput />
            <DateTimePickerIcon as={CalendarDaysIcon} />
          </DateTimePickerTrigger>
        </DateTimePicker>
      </Box>

      <Box className="p-4 border border-border rounded-lg bg-card">
        <Text className="text-sm font-semibold mb-3 text-card-foreground">Different Sizes</Text>
        <VStack space="md">
          <DateTimePicker
            value={date}
            onChange={setDate}
            mode="date"
          >
            <DateTimePickerTrigger size="sm" variant="outline">
              <DateTimePickerInput />
              <DateTimePickerIcon as={CalendarDaysIcon} size="sm" />
            </DateTimePickerTrigger>
          </DateTimePicker>

          <DateTimePicker
            value={date}
            onChange={setDate}
            mode="date"
          >
            <DateTimePickerTrigger size="md" variant="outline">
              <DateTimePickerInput />
              <DateTimePickerIcon as={CalendarDaysIcon} size="md" />
            </DateTimePickerTrigger>
          </DateTimePicker>

          <DateTimePicker
            value={date}
            onChange={setDate}
            mode="date"
          >
            <DateTimePickerTrigger size="lg" variant="outline">
              <DateTimePickerInput />
              <DateTimePickerIcon as={CalendarDaysIcon} size="lg" />
            </DateTimePickerTrigger>
          </DateTimePicker>
        </VStack>
      </Box>
    </VStack>
  );
}`}
  argTypes={{
  "variant": {
    "control": {
      "type": "select"
    },
    "options": [
      "outline",
      "underlined",
      "rounded"
    ],
    "defaultValue": "outline"
  },
  "size": {
    "control": {
      "type": "select"
    },
    "options": [
      "sm",
      "md",
      "lg",
      "xl"
    ],
    "defaultValue": "md"
  }
}}
  reactLive={{ DateTimePicker, DateTimePickerTrigger, DateTimePickerInput, DateTimePickerIcon, Box, Text, VStack, CalendarDaysIcon }}
  importMap={{"@/components/ui/date-time-picker":["DateTimePicker","DateTimePickerTrigger","DateTimePickerInput","DateTimePickerIcon"],"@/components/ui/box":["Box"],"@/components/ui/text":["Text"],"@/components/ui/vstack":["VStack"],"@/components/ui/icon":["CalendarDaysIcon"]}}
/>


  #### With Form Control

  Use DateTimePicker with FormControl for proper labeling, helper text, and validation states
  
  <CodePreviewer
  code={`function Example() {
  const [date, setDate] = React.useState(null);
  const [isInvalid, setIsInvalid] = React.useState(false);

  // Validate that date is not in the past
  React.useEffect(() => {
    if (date) {
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      setIsInvalid(date < today);
    }
  }, [date]);

  return (
    <FormControl isInvalid={isInvalid} className="w-full">
      <FormControlLabel>
        <FormControlLabelText>Event Date</FormControlLabelText>
      </FormControlLabel>
      <DateTimePicker
        value={date}
        onChange={setDate}
        mode="date"
        placeholder="Select event date"
      >
        <DateTimePickerTrigger isInvalid={isInvalid}>
          <DateTimePickerInput />
          <DateTimePickerIcon as={CalendarDaysIcon} />
        </DateTimePickerTrigger>
      </DateTimePicker>
      <FormControlHelper>
        <FormControlHelperText>
          Choose a future date for your event
        </FormControlHelperText>
      </FormControlHelper>
      <FormControlError>
        <FormControlErrorIcon as={AlertCircleIcon} />
        <FormControlErrorText>
          Event date cannot be in the past
        </FormControlErrorText>
      </FormControlError>
    </FormControl>
  );
}`}
  argTypes={{}}
  reactLive={{ DateTimePicker, DateTimePickerTrigger, DateTimePickerInput, DateTimePickerIcon, FormControl, FormControlLabel, FormControlLabelText, FormControlHelper, FormControlHelperText, FormControlError, FormControlErrorText, FormControlErrorIcon, CalendarDaysIcon, AlertCircleIcon }}
  importMap={{"@/components/ui/date-time-picker":["DateTimePicker","DateTimePickerTrigger","DateTimePickerInput","DateTimePickerIcon"],"@/components/ui/form-control":["FormControl","FormControlLabel","FormControlLabelText","FormControlHelper","FormControlHelperText","FormControlError","FormControlErrorText","FormControlErrorIcon"],"@/components/ui/icon":["CalendarDaysIcon","AlertCircleIcon"]}}
/>